<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Simple Plot</title>
	<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
	<script src="yahoo-finance-stock-data.js"></script>
	<script src="bower_components/underscore/underscore.js"></script>
	 <script type="text/javascript" src="https://www.google.com/jsapi"></script>
		<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
	 <script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
	 <style>
		#chart_div {
			position: absolute;
			top: 50px;
			left: 0;
			right: 0;
			bottom: 0;
		}
		#req_form {
			z-index: 1000;
			width: 100%;
			text-align: center;
			padding-top: 10px;
		}
	 </style>
</head>
<body>
	<form id="req_form" class="form-inline" onsubmit="return handleSubmit();">
		<input class="form-control input" type="text" id="s1" placeholder="Symbol 1" value="MSFT" />
		<input class="form-control input" type="text" id="s2" placeholder="Symbol 2" value="AAPL" />
		<input class="form-control input" type="text" id="d1" placeholder="Start" value="2013-01-01" />
		<input class="form-control input" type="text" id="d2" placeholder="End" value="2013-02-05" />
		<input class="form-control btn btn-primary" type="submit" />
	</form>
	<div id="chart_div"></div>
</body>

<script>
var stocks = ['MSFT', 'AAPL']
function handleSubmit() {
	console.log("Sub");
	var s1 = $('#s1').val();
	var s2 = $('#s2').val();
	stocks = [s1, s2];
	console.log(stocks);
	drawChart();
	return false;
}


google.load("visualization", "1", {packages:["corechart"]});
      google.setOnLoadCallback(drawChart);
      function drawChart() {



      	getZippedDailyAvgs({ stocks: stocks, startDate: $('#d1').val(), endDate: $('#d2').val() }, 'historicaldata', function(err, data) {
	    console.log(data);

	    var lr = data.length - 1;
	    console.log(lr);
	    data[lr][2] = data[lr][1];
	    data[lr][1] = null;


	    


	    // var gdata = google.visualization.arrayToDataTable(data);
	    var gdata = new google.visualization.DataTable();
ax1 = data[0][0];
ax2 = data[0][1];
gdata.addColumn('number', ax1);
gdata.addColumn('number', ax2);
gdata.addColumn('number', 'Latest');
// gdata.addColumn('string', 'Date');
data.splice(0, 1);

gdata.addRows(data);



	    var options = {
          title: ax1 + ' vs ' + ax2,
          hAxis: {title: ax1},
          vAxis: {title: ax2},
          // legend: 'none',
          trendlines: {0: {
          	labelInLegent: 'Linear fit',
          	visibleInLegend: true,
          	showR2: true
          }}
        };
        var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));

        chart.draw(gdata, options);
    }

	);
}


	
</script>
</html>